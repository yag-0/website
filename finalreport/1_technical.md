# Технічна документація Flask Market

## Зміст
1. [Архітектура системи](#архітектура-системи)
2. [Структура проекту](#структура-проекту)
3. [Технологічний стек](#технологічний-стек)
4. [Компоненти системи](#компоненти-системи)
5. [Потік даних](#потік-даних)

---

## Архітектура системи

### Діаграма архітектури

```
┌──────────────────────────────────────────────────────────────┐
│                         CLIENT LAYER                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │  Web Browser │  │  Mobile Dev  │  │  API Clients │        │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘        │
└─────────┼─────────────────┼─────────────────┼────────────────┘
          │                 │                 │
          └─────────────────┴─────────────────┘
                             │
                    HTTP/HTTPS Requests
                             │
          ┌──────────────────▼──────────────────────────────────┐
          │              LOAD BALANCER (optional)                │
          └──────────────────┬──────────────────────────────────┘
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                   APPLICATION LAYER                              │
│  ┌────────────────────────────────────────────────────────┐    │
│  │               Flask Application (app.py)                │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌─────────────┐  │    │
│  │  │   Routes     │  │  Blueprints  │  │  Templates  │  │    │
│  │  │  (Handlers)  │  │   (API BP)   │  │   (Jinja2)  │  │    │
│  │  └──────┬───────┘  └──────┬───────┘  └──────┬──────┘  │    │
│  └─────────┼──────────────────┼──────────────────┼─────────┘    │
│            │                  │                  │               │
│  ┌─────────▼──────────────────▼──────────────────▼─────────┐   │
│  │              Business Logic Layer                        │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐        │   │
│  │  │  Session   │  │   Flash    │  │   CORS     │        │   │
│  │  │  Manager   │  │  Messages  │  │  Handler   │        │   │
│  │  └────────────┘  └────────────┘  └────────────┘        │   │
│  └──────────────────────────┬───────────────────────────────┘   │
└─────────────────────────────┼───────────────────────────────────┘
                              │
┌─────────────────────────────▼───────────────────────────────────┐
│                      DATA ACCESS LAYER                          │
│  ┌────────────────────────────────────────────────────────┐     │
│  │             models.py (Database Models)                │     │
│  │  ┌──────────────┐  ┌──────────────┐  ┌─────────────┐   │     │
│  │  │ DB Connection│  │  Initialize  │  │   Queries   │   │     │
│  │  │   Manager    │  │   Database   │  │  Functions  │   │     │
│  │  └──────┬───────┘  └──────┬───────┘  └──────┬──────┘   │     │
│  └─────────┼──────────────────┼──────────────────┼─────────┘    │
└────────────┼──────────────────┼──────────────────┼──────────────┘
             │                  │                  │
┌────────────▼──────────────────▼──────────────────▼──────────────┐
│                      DATABASE LAYER                              │
│  ┌────────────────────────────────────────────────────────┐    │
│  │                   SQLite Database                       │    │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │    │
│  │  │ products │ │ orders   │ │customers │ │ feedback │  │    │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │    │
│  │  ┌──────────┐ ┌──────────┐                            │    │
│  │  │order_items│ │promo_codes│                           │    │
│  │  └──────────┘ └──────────┘                            │    │
│  └────────────────────────────────────────────────────────┘    │
└──────────────────────────────────────────────────────────────────┘
```

### Тип архітектури
**Монолітна MVC (Model-View-Controller)** з елементами REST API

---

## Структура проекту

```
lab03-flaskProject/
│
├── app.py                 # Головний файл застосунку
├── models.py              # Моделі бази даних
├── api.py                 # REST API Blueprint
├── requirements.txt       # Python залежності
├── site.db               # SQLite база даних
│
├── static/               # Статичні файли
│   ├── css/
│   ├── js/
│   └── images/
│
├── templates/            # Jinja2 шаблони
│   ├── base.html        # Базовий шаблон
│   ├── home.html        # Головна сторінка
│   ├── market.html      # Каталог товарів
│   ├── cart.html        # Кошик
│   ├── reviews.html     # Відгуки
│   ├── about.html       # Про нас
│   ├── api-demo.html    # API Demo
│   └── admin/           # Адмін панель
│       ├── login.html
│       ├── index.html
│       ├── products.html
│       ├── orders.html
│       └── promo.html
│
├── Dockerfile            # Docker конфігурація
├── docker-compose.yml    # Docker Compose
├── .dockerignore        # Виключення для Docker
├── .env                 # Змінні середовища
├── .env.example         # Приклад змінних
│
└── finalreport/         # Документація
    ├── technical.md
    ├── database.md
    ├── api.md
    ├── user-guide.md
    ├── deployment.md
    └── README.md
```

---

## Технологічний стек

### Backend
- **Python 3.11** - мова програмування
- **Flask 3.0.0** - веб-фреймворк
- **Werkzeug 3.0.1** - WSGI утиліти
- **SQLite 3** - база даних
- **Flasgger 0.9.7.1** - Swagger/OpenAPI документація

### Frontend
- **Jinja2** - шаблонізатор
- **Tailwind CSS** - CSS фреймворк
- **Vanilla JavaScript** - клієнтська логіка

### Deployment
- **Docker** - контейнеризація
- **Docker Compose** - оркестрація

### Додаткові інструменти
- **Flask-CORS 4.0.0** - CORS підтримка
- **rpds-py 0.18.0** - швидкі структури даних

---

## Компоненти системи

### 1. Веб-інтерфейс
**Функції:**
- Перегляд каталогу товарів з фільтрацією
- Управління кошиком покупок
- Оформлення замовлень з промокодами
- Залишення відгуків
- Перегляд інформації про компанію
- Темна/світла тема
- Клавіатурна навігація

**Технології:**
- Jinja2 templates
- Tailwind CSS для стилізації
- JavaScript для інтерактивності

### 2. REST API
**Функції:**
- CRUD операції для товарів
- Управління замовленнями
- Обробка промокодів
- Отримання статистики

**Особливості:**
- RESTful endpoints
- JSON формат даних
- Swagger документація
- CORS підтримка

### 3. Адміністративна панель
**Функції:**
- Управління товарами
- Перегляд та обробка замовлень
- Керування промокодами
- Аналітика продажів

**Безпека:**
- Парольна авторизація
- Session-based аутентифікація
- Декоратор admin_required

### 4. База даних
**SQLite**
- Легка файлова БД
- ACID транзакції
- Підтримка foreign keys
- Автоінкремент ID

---

## Потік даних

### 1. Запит користувача → Відповідь

```
User Request
     │
     ▼
┌─────────────────┐
│  Flask Router   │  ← URL matching
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  View Handler   │  ← app.py route functions
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Business Logic  │  ← Validation, calculations
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   models.py     │  ← Database queries
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   SQLite DB     │  ← Read/Write operations
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ Template Render │  ← Jinja2 rendering
└────────┬────────┘
         │
         ▼
    HTML Response
```

### 2. API Request → JSON Response

```
API Client
     │
     ▼
┌─────────────────┐
│  api.py         │  ← Blueprint routes
│  (Blueprint)    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  get_db_conn()  │  ← models.py
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│   SQLite DB     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  JSON Response  │  ← jsonify()
└─────────────────┘
```

### 3. Замовлення з промокодом

```
1. User заповнює форму замовлення
           │
           ▼
2. POST /order/create
           │
           ▼
3. Валідація промокоду (якщо є)
           │
           ├─ Valid → Apply discount
           └─ Invalid → Error message
           │
           ▼
4. Створення запису в orders
           │
           ▼
5. Створення записів в order_items
           │
           ▼
6. Зменшення stock товарів
           │
           ▼
7. Очищення кошика в session
           │
           ▼
8. Redirect → Order success page
```

---

## Масштабованість та продуктивність

### Поточні обмеження
- SQLite підходить тільки для невеликого трафіку
- Один процес Flask (не multi-threaded у dev mode)
- Відсутність кешування
- Без черги задач

### Рекомендації для production

1. **База даних:**
   - Перейти на PostgreSQL або MySQL
   - Додати connection pooling

2. **WSGI сервер:**
   - Використовувати Gunicorn або uWSGI
   - Налаштувати workers (4-8)

3. **Кешування:**
   - Redis для session storage
   - Memcached для query results

4. **Статичні файли:**
   - CDN для static assets
   - Nginx для обслуговування статики

5. **Моніторинг:**
   - Prometheus + Grafana
   - Sentry для error tracking
   - ELK stack для логів

---

## Безпека

### Реалізовані заходи
- ✅ Session-based аутентифікація для адміна
- ✅ CSRF захист через Flask-WTF (в формах)
- ✅ Escape HTML в templates (Jinja2 auto-escape)
- ✅ Prepared statements (SQLite parameterized queries)

### Рекомендації для production
- 🔒 HTTPS (TLS/SSL сертифікати)
- 🔒 Більш складний пароль адміна або OAuth
- 🔒 Rate limiting для API
- 🔒 Валідація всіх inputs
- 🔒 Content Security Policy headers
- 🔒 Регулярне оновлення залежностей

---

## Висновок

Flask Market - це монолітний веб-застосунок з елементами REST API, побудований на Flask та SQLite. Архітектура проста та підходить для малих та середніх проектів, але потребує модифікацій для масштабування до high-traffic сценаріїв.

**Сильні сторони:**
- Проста і зрозуміла архітектура
- Швидке розгортання
- Підходить для навчальних цілей
- Легко модифікувати

**Слабкі сторони:**
- SQLite не підходить для великого навантаження
- Відсутність асинхронності
- Мінімальне кешування
- Базова безпека

Для production використання рекомендується мігрувати на PostgreSQL, додати Gunicorn/uWSGI, налаштувати Redis кешування та впровадити HTTPS.
