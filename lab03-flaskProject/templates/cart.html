{% extends "base.html" %}
{% block title %}Кошик{% endblock %}
{% block content %}
<h1 class="text-3xl font-bold mb-4">Кошик</h1>

{% if items and items|length > 0 %}
    <div class="bg-white rounded shadow p-4">
        <table class="w-full">
            <thead>
                <tr class="border-b">
                    <th class="text-left p-2">Товар</th>
                    <th class="text-left p-2">Ціна</th>
                    <th class="text-left p-2">Кількість</th>
                    <th class="text-left p-2">Сума</th>
                    <th class="text-left p-2">Дія</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                    <tr class="border-b">
                        <td class="p-2">{{ item.name }}</td>
                        <td class="p-2">{{ '%.2f'|format(item.price) }} грн</td>
                        <td class="p-2">
                            <form method="post" action="{{ url_for('cart_update', product_id=item.id) }}" class="inline-flex items-center gap-2">
                                <input type="number" name="quantity" value="{{ item.cart_quantity }}" min="1" max="{{ item.stock }}" class="w-20 p-1 border rounded" />
                                <button type="submit" class="bg-blue-500 text-white px-2 py-1 rounded text-sm">Оновити</button>
                            </form>
                        </td>
                        <td class="p-2 font-semibold">{{ '%.2f'|format(item.subtotal) }} грн</td>
                        <td class="p-2">
                            <form method="post" action="{{ url_for('cart_remove', product_id=item.id) }}" class="inline">
                                <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded text-sm">Видалити</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3" class="p-2 text-right font-bold">Сума товарів:</td>
                    <td class="p-2 font-bold text-lg">{{ '%.2f'|format(total) }} грн</td>
                    <td></td>
                </tr>
                {% if discount > 0 %}
                <tr>
                    <td colspan="3" class="p-2 text-right text-green-600 font-semibold">Знижка ({{ promo_discount_percent }}%):</td>
                    <td class="p-2 text-green-600 font-semibold">-{{ '%.2f'|format(discount) }} грн</td>
                    <td></td>
                </tr>
                <tr class="border-t-2">
                    <td colspan="3" class="p-2 text-right font-bold text-xl">Загальна сума:</td>
                    <td class="p-2 font-bold text-xl text-blue-600">{{ '%.2f'|format(final_total) }} грн</td>
                    <td></td>
                </tr>
                {% else %}
                <tr class="border-t-2">
                    <td colspan="3" class="p-2 text-right font-bold text-xl">Загальна сума:</td>
                    <td class="p-2 font-bold text-xl">{{ '%.2f'|format(total) }} грн</td>
                    <td></td>
                </tr>
                {% endif %}
            </tfoot>
        </table>
    </div>

    <div class="mt-6 bg-white rounded shadow p-4 max-w-md">
        <h2 class="text-xl font-semibold mb-4">Промокод</h2>
        {% if promo_code %}
            <div class="bg-green-100 border border-green-300 rounded p-3 mb-3">
                <p class="text-green-800 font-semibold">✓ Промокод "{{ promo_code }}" застосовано ({{ promo_discount_percent }}% знижка)</p>
                <form method="post" action="{{ url_for('cart_remove_promo') }}" class="mt-2">
                    <button type="submit" class="text-sm text-red-600 hover:underline">Скасувати промокод</button>
                </form>
            </div>
        {% else %}
            <form method="post" action="{{ url_for('cart_apply_promo') }}" class="flex gap-2">
                <input type="text" name="promo_code" placeholder="Введіть промокод" class="flex-1 p-2 border rounded" />
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Застосувати</button>
            </form>
        {% endif %}
    </div>

    <div class="mt-6 bg-white rounded shadow p-4 max-w-md">
        <h2 class="text-xl font-semibold mb-4">Оформлення замовлення</h2>
        <form method="post" action="{{ url_for('cart_checkout') }}" class="space-y-3">
            <div>
                <label class="block text-sm font-medium mb-1">Ім'я *</label>
                <input type="text" name="name" required class="w-full p-2 border rounded" />
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Email *</label>
                <input type="email" name="email" required class="w-full p-2 border rounded" />
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Телефон</label>
                <input type="text" name="phone" class="w-full p-2 border rounded" />
            </div>
            <button type="submit" class="w-full bg-green-600 text-white px-4 py-2 rounded font-semibold hover:bg-green-700">
                Оформити замовлення
            </button>
        </form>
    </div>
{% else %}
    <div class="bg-white rounded shadow p-4">
        <p class="text-lg">Ваш кошик порожній</p>
        <a href="{{ url_for('market') }}" class="inline-block mt-4 bg-blue-500 text-white px-4 py-2 rounded">Перейти до магазину</a>
    </div>
{% endif %}

{% endblock %}
